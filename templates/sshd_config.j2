{{ ansible_managed | comment }}

{%- macro render_options(options={}, blank_lines=true) %}
{% include "sshd_options.j2" %}
{%- endmacro %}

{% if sshd_options.sshd_pid_file is defined %}PidFile {{ sshd_options.sshd_pid_file }}{% endif %}

{% if sshd_options.sshd_max_startups is defined %}MaxStartups {{ sshd_options.sshd_max_startups }}{% endif %}

{% if sshd_options.sshd_protocol_version is defined %}Protocol {{ sshd_options.sshd_protocol_version }}{% endif %}

{% if sshd_options.sshd_port is defined %}Port {{ sshd_options.sshd_port }}{% endif %}

{% if sshd_options.sshd_address_family is defined %}AddressFamily {{ sshd_options.sshd_address_family }}{% endif %}

{% for address in sshd_listen_addresses | default([]) %}
ListenAddress {{ address }}
{% endfor %}

{{ render_options(sshd_options) }}
{% for r in sshd_match_rules | default([]) | selectattr("state", "equalto", "present") | list %}
Match {% for c in r.conditions %}{{ c.type }} {{ c.pattern }}
{% endfor %}
{{ render_options(r.options, blank_lines=false) | indent(width=2, indentfirst=true) }}
{% endfor %}
